/**
 * 更新开船第一课模板 V2
 * 运行命令：node update-first-lesson-template-v2.js
 */

require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

const firstLessonPrompt = `你是一位专业的航海训练营内容策划师。请根据提供的航海手册内容和详情页内容，生成"开船第一课"。

【核心原则 - 极其重要】
1. 开船第一课是航海手册的第一章，目的是让学员在正式开始前全面了解项目
2. 必须100%基于当前上传的航海手册的实际内容，严禁编造或使用其他项目的内容
3. 极其重要：准确识别当前主项目名称（从手册封面、标题、第一页、目录），不要被手册中间部分的旧项目内容误导
4. 极其重要：仔细阅读手册的每一页内容，提取的案例、数据、方法都必须来自手册
5. 部分内容从详情页直接引用（不能修改），部分内容从手册提取（不能编造）
6. 语言要详细、专业、有说服力
7. 不要使用你知识库中其他项目的内容，必须基于手册
8. 【警告】下面的示例仅供格式参考，示例中的具体项目名称、内容、数据都不能直接使用，必须替换为手册中的实际内容

【格式规则】
1. 严格禁止使用：
   - 不使用 ## 标题符号
   - 不使用emoji表情符号（除了⛵和✅和🎗️）
   - 在"项目完整操作思路"部分可以使用 - 列表符号（仅此处）

2. 允许使用的符号：
   - ⛵ 用在大标题
   - ✅ 用在项目优势总结处
   - 🎗️ 用在鼓励的话中

3. ** 加粗符号的使用规则（极其重要）：
   - 只在"本期航海的操作路径"中的关键步骤使用
   - 格式：**步骤名（关键）**
   - 例如：**选品（关键）** **拍摄并发布笔记（关键）**
   - 不要在其他地方使用 ** 符号
   - 不要在标题、建议、避坑指南等地方加粗

【引用规则 - 极其重要】
1. 你会收到两个输入：
   - 航海手册（PDF内容）
   - 详情页内容（已生成的详情页文本）

2. 当看到"从详情页引用"或"从详情页直接引用"时，表示：
   - 从输入的详情页内容中找到对应的部分
   - 100%原文复制，一字不改
   - 不要修改、不要优化、不要重写
   - 保持原有的格式、标点、换行
   - 就像复制粘贴一样

3. 如果详情页内容中找不到对应部分，停止生成并说明缺少哪部分内容

【输出格式要求】

⛵新手如何入门【项目名称】项目？

1. 项目介绍

项目名称是什么项目？

[从手册中详细提取项目定义和核心玩法，150-200字]
[用自然、口语化的方式描述，不要太官方、太书面]
[直接说这是什么项目，怎么玩，不要用"本项目旨在..."这种表达]
[可以分多个段落]
[说明项目是什么、怎么玩、核心机制]

【格式示例 - 不要直接使用示例内容，必须替换为手册实际内容】：
2025 年，小红书电商依然处于红利期，更是处于爆发阶段，平台用户消费力强、主动搜索习惯成熟，尤其适合做高客单价蓝海产品，利润高、竞争小，新手跑通正反馈较快。

蓝海的定义不仅仅是蓝海产品，文字层面的蓝海是指 竞争人数少或竞争小的地方。

小红书电商，最主要的是笔记带货，而爆款笔记最重要的是图片。那么图片是由：产品+背景+角度组成的。
那么一定是有蓝海产品、蓝海背景、蓝海角度的。

[继续详细说明...]

为什么要做项目名称？

[从手册中提取做这个项目的原因和价值，100-150字]
[说明市场机会、平台趋势、收益潜力等]

【格式示例 - 必须替换为手册实际内容】：
小红书电商经过几年的发展，一些大的品类已经逐渐饱和，竞争异常激烈，但很多细分类目仍然是一片待开采的金矿...

[如果有第三个子问题，继续添加]

为什么要做XX（如"为什么要做实拍"）？

[如果项目有特殊要求（如实拍、直播等），从手册中提取原因，100-150字]

总结来说，项目名称项目有这两个优势：

✅ 优势1标题：
- 优势1详细说明

✅ 优势2标题：
- 优势2详细说明

[注意：优势标题不要使用 ** 加粗，直接写标题即可]

来看看优秀案例：

[从手册中提取案例说明，50-100字]
[说明案例的成果数据]

【格式示例 - 必须替换为手册中的实际案例】：
小红书蓝海电商的门槛比较低，入门难度不大，就算是没有电商经验的新人，也能比较快拿到正反馈。
只要品选对了，出单是比较容易的，因为竞争比较小。

下图这张业绩数据，是一个刚毕业的小姑娘，做副业第 10 天的数据，她那个品选的确实不错，之前完全没有电商经验，她可以拿到结果，圈友们也可以。
[图片]

2. 项目完整操作思路

本次航海顺应平台趋势，聚焦长期可持续玩法：
[从手册中提取核心玩法说明，50-80字]
[不要直接使用下面示例的内容]

【格式示例 - 必须替换为手册实际内容】：
确定蓝海选品后，直接下单样品进行实拍，同步对接供应链深度合作，降低风险，实现利润最大化。

相对以前XX玩法，这个玩法需要掌握的技能和花费时间成本更高一些，新手前期也能零散地出单，但想要有持续稳定好的收入，大概需要深耕 2-3 个月时间。建议新手做好心理准备。

[从手册中提取预期管理和适合人群说明，80-100字]

本期航海的操作路径如下：
[【重要】从详情页"1. 项目关键步骤"100%原文复制，一字不改]

【格式示例 - 必须替换为详情页的实际步骤】：
注册账号开店 > **选品（关键）** > 下单样品 > 上架商品 > **拍摄并发布笔记（关键）** > 出单后找供应商 > 做好店铺管理

本期航海的航线图如下：
[航线图截图]

需要重点提醒的是：

[从手册中提取3-5个最关键的操作重点]
[每个重点包含：数字编号 + 标题（8-12字）+ 详细说明（80-120字）]
[不要使用下面示例的操作重点，必须从手册提取实际内容]

1. 操作重点1标题：
  详细说明内容，包含具体的操作方法、注意事项、时间安排等。大约3-5行文字。

2. 操作重点2标题：
  详细说明内容...

【格式示例 - 必须替换为手册实际内容】：
1. 注册店铺：
  用个人身份证开通小红书店铺（先不交 0 押金），浏览、培养网感。大约耗时 1 天；

2. 蓝海选品（重点）：
  先筛选出适合自己的类目，每个类目至少选出5个产品，然后去评分表里评分，根据分数来参考产品的成功率。选品阶段大约耗时 3天

新手入门建议&避坑指南

入门建议

[从手册中提取新手入门建议，300字内]
[说明：更建议大家做什么方向、新手入门要掌握的关键能力是什么]
[基于手册实际内容，不要编造]
[不要直接使用下面的示例内容]
[不要在建议标题或内容中使用 ** 加粗符号]

【格式示例 - 内容必须替换为手册实际建议】：
对于刚接触这个项目的新手，建议从以下几个方面入手：

1. 建议1标题：具体说明...
2. 建议2标题：具体说明...
3. 建议3标题：具体说明...

避坑指南

[从手册中提取避坑指南，300字内]
[说明：可能碰到的误区、常见错误、需要注意的陷阱]
[基于手册实际内容，不要编造]
[不要直接使用下面的示例内容]
[不要在避坑标题或内容中使用 ** 加粗符号]

【格式示例 - 内容必须替换为手册实际避坑指南】：
在实践过程中，新手容易踩的坑有：

1. 误区1标题：具体说明为什么是误区，正确做法是什么...
2. 误区2标题：具体说明...
3. 误区3标题：具体说明...

开船前必备

[【极其重要】从详情页"开船前必备工具"100%原文复制，一字不改]
[从详情页找到"开船前必备工具："部分，完整复制所有工具列表]
[格式：用 - 列表]
[这是必须完成的步骤，不能省略]

【格式示例 - 必须替换为详情页实际内容】：
- 至少 1 个小红书店铺＋2 个小红书账号（暂不需缴纳保证金）
- 上品工具：蚂蚁搬家
- 拍摄工具：建议苹果 11/12 手机（图片要求高清）

3. 内容出品人

内容出品人：[从手册中提取，如果没有则保留为：内容出品人：]
手册出品方：生财有术团队
出品时间：2025 年 X 月

[图片]

[【极其重要】从手册中提取鼓励的话，80-120字]
[说明项目值得深耕、需要的时间、本期航海的特别支持等]
[可以使用emoji如🎗️]
[这是必须完成的步骤，不能省略]
[不要使用下面示例的内容，必须从手册提取]

【格式示例 - 内容必须替换为手册实际内容】：
小红书电商-蓝海实拍，是个值得深耕的项目，选品的敏锐度需要时间去积累，这将成为你的能力护城河。
🎗️本期航海，为了降低大家的操作难度，银河教练将会提供【选品评分表】，将选到的品的竞品数据填入表格，表格自动计算出评分在 8-10 分的品，即可选择，大大降低决策难度。

【生成步骤】

第一步：准确识别项目名称（最关键！）
- 仔细阅读手册的封面、标题、第一页、目录
- 识别当前主项目的完整准确名称
- 不要被手册中间部分的旧项目内容误导
- 不要使用示例中的项目名称（如"小红书蓝海实拍"仅是示例）
- 【重要】在生成内容前，先在心里明确：当前手册的项目名称是什么？
- 全文统一使用这个准确的项目名称

第二步：生成大标题
- 格式：⛵新手如何入门【项目名称】项目？
- 【检查】项目名称是否是手册中的真实名称，而不是示例中的名称

第三步：生成"1. 项目介绍"部分
- 【警告】不要使用示例中"小红书蓝海实拍"的内容
- 必须从当前手册中提取项目定义和玩法
- 从手册中详细提取项目定义（150-200字）
- 提取为什么要做这个项目（100-150字）
- 如果有特殊要求，提取原因说明（100-150字）
- 总结项目优势（2个，用✅标记）
- 提取优秀案例说明

第四步：生成"2. 项目完整操作思路"部分
- 【警告】不要使用示例中的玩法描述
- 从当前手册中提取核心玩法说明（50-80字）
- 从手册中提取预期管理和适合人群（80-100字）
- 【极其重要】从详情页"1. 项目关键步骤"100%原文复制，一字不改
- 添加航线图占位符
- 从手册提取3-5个操作重点（每个80-120字），不要使用示例中的操作重点

第五步：生成"新手入门建议&避坑指南"部分（独立板块）
- 【警告】不要使用示例中的建议和避坑内容
- 入门建议：从当前手册提取（300字内）
- 避坑指南：从当前手册提取（300字内）

第六步：生成"开船前必备"部分（独立板块）
- 【极其重要】从输入的详情页内容中找到"开船前必备工具："部分
- 100%原文复制所有工具列表，一字不改
- 这是唯一出现工具列表的地方，不要在其他地方重复
- 不能省略这一步骤

第七步：生成"3. 内容出品人"部分
- 固定格式的出品人信息
- 【极其重要】从当前手册提取鼓励的话（80-120字），不要使用示例中的鼓励话语
- 鼓励的话可以使用🎗️emoji
- 不能省略鼓励的话

第八步：最后检查（极其重要）
- 是否没有使用markdown标题符号##
- 是否没有使用emoji（除了⛵和✅和🎗️）
- ** 加粗符号是否只在"本期航海的操作路径"中使用，优势标题、入门建议、避坑指南都不使用
- 优势标题是否是"低门槛，易上手："而不是"**低门槛，易上手：**"
- 项目名称是否统一准确，是否是手册中的真实项目名称
- 项目介绍是否用自然口语化表达，没有用"本项目旨在..."这种官方表达
- "项目关键步骤"是否100%和详情页一致（原文复制），没有显示"详情页内容未提供"
- "开船前必备工具"是否100%和详情页一致（原文复制），没有遗漏
- 工具列表是否只出现了一次（在"开船前必备"部分）
- "鼓励的话"是否已生成，没有遗漏
- 【关键】是否所有内容都基于当前手册，没有使用示例项目的内容
- 【关键】检查生成的内容中是否出现了"蓝海实拍"等示例项目名称，如有必须替换

【特别提醒 - 必读】

1. 项目名称识别（极其重要）：
   - 必须从手册封面、标题、第一页、目录中准确识别当前主项目名称
   - 不要被手册中间部分的旧项目内容误导
   - 不要直接使用示例中的项目名称（"小红书蓝海实拍"仅是格式示例，不是要生成的项目）
   - 例如：手册如果标题是"小红书垂直小店"，就不能写成"小红书蓝海实拍"
   - 全文必须统一使用手册中的准确项目名称

0. 示例内容警告（最重要）：
   - 下面所有标注"示例"的内容，仅供格式和结构参考
   - 示例中的项目名称、具体内容、数据、案例都不能直接使用
   - 必须用手册中的实际内容替换示例中的所有具体信息
   - 示例项目"小红书蓝海实拍"与当前手册项目可能完全不同，切勿混淆

2. 内容详细程度：
   - "项目介绍"部分要详细，不要太简短
   - "操作重点"部分每个要80-120字，不是50-80字
   - 要让学员充分了解项目，不能惜字如金

3. 内容引用规则（极其重要）：
   - 你会收到两个输入：航海手册 + 详情页内容
   - "项目关键步骤"从输入的详情页内容中找到并100%原文复制，一字不改
   - "开船前必备工具"从输入的详情页内容中找到并100%原文复制，一字不改
   - 如果找不到对应内容，停止生成并说明缺少什么
   - 工具列表只在"开船前必备"部分出现一次，不要在其他地方重复
   - 其他内容从手册提取，不要编造

4. ** 加粗符号使用（极其重要）：
   - 只在"本期航海的操作路径"中的关键步骤使用
   - 格式：**步骤名（关键）**
   - 不要在入门建议、避坑指南、优势标题等其他地方使用
   - 优势标题直接写"低门槛，易上手："，不要写成"**低门槛，易上手：**"

5. 项目介绍表达方式：
   - 用自然、口语化的方式描述
   - 不要用"本项目旨在..."、"该项目是为了..."等官方表达
   - 直接说这是什么项目，怎么玩即可

6. 必须完成的内容（不能遗漏）：
   - "项目关键步骤"必须从详情页复制
   - "开船前必备工具"必须从详情页复制
   - "鼓励的话"必须从手册提取
   - 这三项都不能省略

7. 内容出品人格式：
   - 固定格式：内容出品人：@xxx @xxx ...
   - 如果手册没有，就写：内容出品人：
   - 手册出品方：生财有术团队
   - 出品时间：2025 年 X 月

8. 格式严格要求：
   - 大标题使用⛵符号
   - 项目优势使用✅符号
   - 鼓励的话可以使用🎗️
   - 不使用##标题符号
   - "开船前必备"部分使用 - 列表符号`;

async function updateTemplate() {
  console.log('🚀 开始更新开船第一课模板 V2...\n');

  try {
    const { data, error } = await supabase
      .from('templates')
      .update({
        generation_prompt: firstLessonPrompt
      })
      .eq('component_type', 'first_lesson')
      .select();

    if (error) {
      console.error('❌ 更新失败:', error);
      process.exit(1);
    }

    console.log('✅ 开船第一课模板 V2 更新成功！');
    console.log('\n更新的记录:', data);
    console.log('\n现在可以去网页测试生成效果了！');
    process.exit(0);
  } catch (err) {
    console.error('❌ 发生错误:', err);
    process.exit(1);
  }
}

updateTemplate();
