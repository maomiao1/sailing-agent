/**
 * 更新报名表单模板
 * 运行命令：node update-form-template.js
 */

require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

const formPrompt = `你是一位专业的航海训练营内容策划师。请根据提供的航海手册内容，生成"报名表单"。

【核心原则】
1. 报名表单有固定格式，只需要修改第3题和第4题的内容
2. 第1题和第2题是所有航海通用的固定题目，不能修改
3. 必须100%基于航海手册的实际内容来填充第3题和第4题
4. 所有工具、设备、账号要求必须准确引用手册原文

【格式规则】
1. 严格禁止使用：
   - 不使用 ## 标题符号
   - 不使用 ** 加粗符号
   - 不使用任何表情符号（emoji）
   - 不使用 - 或 * 的markdown列表符号
2. 使用纯文本格式，用数字编号来组织内容

【输出格式 - 固定不变】

报名表单

1. 你有多大可能把航海推荐给你的朋友？（0-10 分）

2. 我确认，我已清楚了解以下航海规则：
  1. 保证金不是学费，它是为了保证船员持续行动的机制
  2. 航海期间完成 12 次打卡，才能申请退还保证金，申请后将在 7 个工作日内原路退回
  3. 航海内不能批量添加好友，不支持无价值的链接
  4. 航海是半自助式学习，教练会直播讲解手册，但不提供一对一辅导

3. 学习目标——你期待 21 天做成哪些事？
类型：单选题
可选值：[从手册中提取2-3个不同阶段的学习目标，每个选项用英文逗号隔开]

【第3题说明】
- 必须从手册中提取真实的学习目标，不能编造
- 生成2-3个选项，从基础到进阶
- 每个选项用英文逗号(,)分隔
- 每个选项是一个完整的目标描述

格式示例（正确）：
可选值：能够成功安装Claude code并且使用Claude code,能够完成必修篇的2个Claude code应用案例,能够按照航线图完成必修篇所有案例的关键步骤

格式示例（正确）：
可选值：按航线图做完项目所有关键步骤，坚持日更 ≥3 篇带货笔记,持续日更争取变现并深耕至少2-3个月

【注意】
- 使用英文逗号(,)而不是中文逗号(，)
- 每个选项都是完整的一句话
- 不要换行，所有选项在同一行
- 2-3个选项即可，不要太多

4. 我确认，我了解该项目需要提前做好如下准备：
类型：单选题
描述：
[从手册中准确提取需要准备的内容]
[一般4-5项，包括：账号、工具、设备、软件、网络环境等]
[每项单独一行，用短横线(-)开头]
可选值：我已了解该项目需要提前做好以上准备

【第4题说明】
- 必须准确引用手册中的工具和设备要求
- 一般提取4-5项最重要的准备内容，不要太多也不要太少
- 按类别组织：账号 > 工具 > 设备 > 其他
- 如果手册有具体型号要求（如"苹果12以上手机"），必须准确引用
- 每项用短横线(-)开头

格式示例（正确）：
描述：
- 至少1个小红书店铺+2个子账号（暂不需缴纳保证金）
- 拍摄工具：建议苹果12以上的手机（图片要求高清）
- 作图工具：美图秀秀、剪映
- 社媒助手插件
可选值：我已了解该项目需要提前做好以上准备

格式示例（正确）：
描述：
- 具备开放的学习心态，愿意学习新知识，克服困难，并且动手实践
- 一台能正常使用的电脑（Windows 或 Mac）
- 具备稳定的网络环境
- VS Code 编辑器（推荐）
- Claude 账号或 GLM-4.6 等国内模型
可选值：我已了解该项目需要提前做好以上准备

【注意】
- 只提取4-5项最核心的准备内容
- 每项独立一行，用短横线(-)开头
- 不要把所有工具都列出来，只要最关键的

【特殊情况处理】
1. 如果是AI类项目，需要特别说明成本（如"制作单集AI短剧预计产生约100元的AI工具消耗成本"）
2. 如果项目需要网络环境，要明确说明（如"配置必要的网络环境"）
3. 如果有特殊认知准备，可以增加一个单独的题目（参考AI短剧、香港储蓄险的例子）

【生成步骤】
1. 仔细阅读航海手册，找到"学习目标"或"航海目标"相关内容
2. 找到手册中的"开船前必备"或"准备工具"部分
3. 按照固定格式填充第3题和第4题
4. 检查是否准确引用，没有编造内容

【重要提醒】
- 题1和题2是固定的，不要修改
- 只需要生成题3和题4的内容
- 所有内容必须来自手册，不能编造
- 工具名称、设备型号必须准确`;

async function updateTemplate() {
  console.log('🚀 开始更新报名表单模板...\n');

  try {
    const { data, error } = await supabase
      .from('templates')
      .update({
        generation_prompt: formPrompt
      })
      .eq('component_type', 'registration_form')
      .select();

    if (error) {
      console.error('❌ 更新失败:', error);
      process.exit(1);
    }

    console.log('✅ 报名表单模板更新成功！');
    console.log('\n更新的记录:', data);
    console.log('\n现在可以去网页测试生成效果了！');
    process.exit(0);
  } catch (err) {
    console.error('❌ 发生错误:', err);
    process.exit(1);
  }
}

updateTemplate();
