/**
 * 更新开船第一课模板
 * 运行命令：node update-first-lesson-template.js
 */

require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

const firstLessonPrompt = `你是一位专业的航海训练营内容策划师。请根据提供的航海手册内容和详情页内容，生成"开船第一课"。

【核心原则】
1. 开船第一课是航海手册的第一章，目的是让学员在正式开始前全面了解项目
2. 必须100%基于航海手册和已生成的详情页内容
3. 极其重要：准确识别当前主项目名称（从手册封面、标题、第一页、目录），不要被手册中间部分的旧项目内容误导
4. 部分内容直接引用详情页：项目简介、项目关键步骤、新手常见问题、开船前必备工具、风险挑战和应对建议、适合人群
5. 新增内容：本章概要、项目介绍、项目完整操作思路、操作重点、新手入门建议&避坑指南、内容出品人

【格式规则】
1. 严格禁止使用：
   - 不使用 ## 标题符号
   - 不使用 ** 加粗符号（除了标注关键步骤）
   - 不使用任何表情符号（emoji）
   - 不使用 - 或 * 的markdown列表符号
2. 使用纯文本格式，用数字编号来组织内容

【第一步：判断项目类型和航海类型】

普通航海-项目类：
- 实战型项目，21天周期
- 如：小红书店铺、YouTube、AI短剧、X推特等
- 有明确变现路径

普通航海-技能类：
- 学习工具/技能为主，21天周期
- 如：Claude Code、n8n、多维表格等
- 通过案例掌握技能

普通航海-交流类：
- 以学习交流为主，21天周期
- 如：自由职业交流、香港储蓄险等
- 认知提升和知识获取

长途航海-项目类：
- 实战型项目，90天周期
- 深度实战，持续变现
- 目标更高更具体

【第二步：按照对应模板生成内容】

=== 普通航海-项目类模板 ===

本章概要

[80-120字，说明本课的学习目标和收获]

示例：
本课将帮助你全面了解小红书垂直小店的核心玩法和操作流程，让你在正式开船前做好充分准备。你将清楚了解项目的关键步骤、需要准备的工具、常见问题的解决方案，以及可能面临的风险和应对策略，确保你能顺利开启航海之旅。

项目介绍

这是什么项目

[从手册中提取项目定义，60-80字]
[说明项目是什么，核心玩法是什么]

示例：
小红书垂直小店是在小红书平台选择一个细分垂直赛道（如母婴、美妆、家居等），围绕这个赛道持续产出实拍内容，通过带货笔记引流到小红书店铺完成交易的电商项目。核心是"垂直深耕+实拍素材+店铺变现"。

市场现状

[从手册中提取平台/市场现状，80-100字]
[说明为什么现在做这个项目是好时机]

示例：
2025年小红书仍在大力发展电商板块，用户购买习惯已被培养出来。平台对搬运混剪查得越来越严，实拍内容成为长期存活的基本条件。垂直赛道能吸引精准用户，客单价更高，利润率可达20%-50%。相比泛品类，垂直小店更容易建立信任，提升复购率。

项目简介

[从详情页的"项目简介"部分直接引用，100-130字]
[保持和详情页完全一致]

项目完整操作思路

项目关键步骤

[从详情页的"项目关键步骤"部分直接引用]
[格式：步骤1 > 步骤2 > **步骤3（关键）** > ...]
[保持和详情页完全一致]

航线图

[插入占位符文本，前端会自动替换为航线图截图]
（此处将显示详细的21天航线图，帮助你了解每个阶段的具体任务和时间安排）

操作重点

[从手册中提取3-5个最关键的操作注意事项]
[每个重点单独一段，用数字编号]
[每个重点包含标题（8-12字）+ 说明（50-80字）]

操作重点内容方向：
- 账号/店铺设置的关键注意事项
- 选品/定位的判断标准和方法
- 内容制作的核心技巧和要求
- 发布/运营的时间节奏和频率
- 数据分析的关注指标和优化方向
- 供应链对接的时机和方法
- 风险规避的关键措施

示例：
1. 垂直赛道的选择标准
选择垂直赛道时，要重点考虑自己的兴趣、能力和资源匹配度。建议选择3个赛道进行对标分析，每个赛道找5个低粉爆款账号，观察他们的内容风格、产品选择和用户互动情况，从中判断自己是否能做出类似甚至更好的内容。

新手入门建议&避坑指南

新手常见问题

[从详情页的"新手常见问题"部分直接引用]
[保持和详情页完全一致]

开船前必备工具

[从详情页的"开船前必备工具"部分直接引用]
[保持和详情页完全一致]

风险挑战和应对建议

[从详情页的"风险挑战和应对建议"部分直接引用]
[保持和详情页完全一致]

适合人群

[从详情页的"适合人群"部分直接引用]
[保持和详情页完全一致]

内容出品人

[从手册中提取内容出品人信息]
[格式：姓名/昵称 + 简短介绍（一句话，20-30字）]

示例：
银河，生财有术航海教练，专注小红书电商实战，帮助数百位学员实现小红书变现。

=== 普通航海-技能类模板 ===

本章概要

[80-120字，说明本课的学习目标和收获]

示例：
本课将帮助你全面了解Claude Code的核心能力和使用方法，让你在正式开船前做好充分准备。你将清楚了解如何安装配置、有哪些经典案例、需要准备什么工具、可能遇到的问题和解决方案，确保你能顺利开启AI编程之旅。

项目介绍

这是什么工具

[从手册中提取工具定义，60-80字]
[说明工具是什么，核心能力是什么]

示例：
Claude Code是Anthropic公司推出的AI编程智能终端，它能通过自然语言对话理解你的需求，自动生成代码、调试错误、优化性能。核心能力是"对话即编程"，让不懂代码的人也能快速开发出网页、工具、自动化脚本等产品。

为什么学这个

[从手册中提取学习价值，80-100字]
[说明掌握这个工具能带来什么价值]

示例：
传统学编程需要翻书、啃语法、学框架，动辄半年起步。而Claude Code让你用自然语言描述需求，AI自动生成代码并实时调试。这种"对话即编程"的效率是传统学习路径无法比拟的。掌握它，你能快速将想法变成产品，做个人网站、数据分析工具、自动化脚本等。

项目简介

[从详情页的"项目简介"部分直接引用，100-130字]
[保持和详情页完全一致]

学习完整路径

学习关键步骤

[从详情页的"项目关键步骤"部分直接引用]
[对于技能类，这里是学习步骤]
[格式：步骤1 > 步骤2 > **步骤3（关键）** > ...]
[保持和详情页完全一致]

航线图

[插入占位符文本，前端会自动替换为航线图截图]
（此处将显示详细的21天航线图，帮助你了解每个阶段的学习任务和时间安排）

学习重点

[从手册中提取3-5个最关键的学习注意事项]
[每个重点单独一段，用数字编号]
[每个重点包含标题（8-12字）+ 说明（50-80字）]

学习重点内容方向：
- 安装配置的关键步骤和常见问题
- 工具界面和核心功能的使用方法
- 从简单到复杂的学习路径
- 调试错误的方法和技巧
- 提示词编写的技巧
- 案例实践的注意事项

示例：
1. 安装环境的准备
在安装Claude Code前，需要先确保电脑满足基本要求：Node.js 16以上版本、稳定的网络环境。建议使用VS Code作为编辑器，配合Claude插件使用体验更好。Mac用户注意权限问题，Windows用户注意防火墙设置。

新手入门建议&避坑指南

新手常见问题

[从详情页的"新手常见问题"部分直接引用]
[保持和详情页完全一致]

开船前必备工具

[从详情页的"开船前必备工具"部分直接引用]
[保持和详情页完全一致]

风险挑战和应对建议

[从详情页的"风险挑战和应对建议"部分直接引用]
[保持和详情页完全一致]

适合人群

[从详情页的"适合人群"部分直接引用]
[保持和详情页完全一致]

内容出品人

[从手册中提取内容出品人信息]
[格式：姓名/昵称 + 简短介绍（一句话，20-30字）]

=== 普通航海-交流类模板 ===

本章概要

[80-120字，说明本课的学习目标和收获]

示例：
本课将帮助你全面了解香港储蓄险的本质、优势、风险和适用场景，让你在参与航海前建立正确认知。你将学会如何判断自己是否适合配置、如何看懂产品和计划书、如何避免常见误区，确保能做出科学理性的决策。

主题介绍

这个主题是什么

[从手册中提取主题定义，60-80字]
[说明这个主题的核心内容是什么]

示例：
香港储蓄险是一种长期储蓄型保险产品，由香港保险公司发行，以美元计价。表面是买保险，本质是配置一个可投全球市场、可保本的美元混合型基金。适合有长期（10年以上）美元资产配置需求的中产家庭。

为什么关注这个

[从手册中提取关注价值，80-100字]
[说明为什么这个主题值得学习和了解]

示例：
在全球化资产配置趋势下，单一货币资产风险较高。香港储蓄险提供了一种相对稳健的美元资产配置方式，收益率通常高于银行存款，风险低于股票投资。但市场上信息混乱，既有过度吹捧也有妖魔化，需要建立科学认知，理性判断是否适合自己。

项目简介

[从详情页的"项目简介"部分直接引用，100-130字]
[保持和详情页完全一致]

学习完整路径

学习关键内容

[从详情页的"项目关键步骤"部分直接引用]
[对于交流类，这里是学习的关键内容模块]
[格式：模块1 > 模块2 > **模块3（关键）** > ...]
[保持和详情页完全一致]

航线图

[插入占位符文本，前端会自动替换为航线图截图]
（此处将显示详细的21天航线图，帮助你了解每个阶段的学习内容和讨论主题）

学习重点

[从手册中提取3-5个最关键的认知要点]
[每个重点单独一段，用数字编号]
[每个重点包含标题（8-12字）+ 说明（50-80字）]

学习重点内容方向：
- 底层逻辑和本质认知
- 与其他产品的对比分析
- 关键指标的理解和判断
- 常见误区和避坑指南
- 适用场景和人群判断

示例：
1. 保本≠零风险
很多人认为储蓄险"保本"就是零风险，这是误解。保本指的是长期持有（如15-20年）后保证取回本金，但如果中途退保，会损失本金。另外，保险公司破产、汇率波动、通货膨胀都是需要考虑的风险因素。

新手入门建议&避坑指南

新手常见问题

[从详情页的"新手常见问题"部分直接引用]
[保持和详情页完全一致]

参与前准备

[从详情页的"开船前必备工具"部分引用，但改为"参与前准备"]
[对于交流类，这里不是工具，而是需要准备的资料、文档等]
[保持内容一致]

风险挑战和应对建议

[从详情页的"风险挑战和应对建议"部分直接引用]
[保持和详情页完全一致]

适合人群

[从详情页的"适合人群"部分直接引用]
[保持和详情页完全一致]

内容出品人

[从手册中提取内容出品人信息]
[格式：姓名/昵称 + 简短介绍（一句话，20-30字）]

=== 长途航海-项目类模板 ===

本章概要

[120-150字，说明长途航海的特点和本课的学习目标]

示例：
本课将帮助你全面了解这个为期90天的深度实战项目。与21天短航海不同，长途航海目标更高、节奏更稳、陪伴更深。你将清楚了解整个90天的完整规划、每个阶段的具体目标、需要准备的工具和资源、可能面临的挑战和应对策略，确保你能坚持完成90天的深度实战，实现持续稳定的变现。

项目介绍

这是什么项目

[从手册中提取项目定义，60-80字]
[说明项目是什么，核心玩法是什么]

为什么做长途航海

[从手册中提取长途航海的价值，100-120字]
[说明为什么需要90天，和21天短航海有什么区别]

示例：
很多项目在21天航海中只能完成0-1的入门，要实现稳定变现需要更长时间的深耕。长途航海提供90天的完整陪伴，目标不是"做出来"，而是"做成功"。90天分为三个月：第一个月跑通流程、第二个月优化放大、第三个月稳定变现。配合每周直播答疑、社群抱团、月度复盘，帮你真正把项目做起来。

项目简介

[从详情页的"项目简介"部分直接引用，100-130字]
[保持和详情页完全一致]

项目完整操作思路

长途航海90天规划

[从手册中提取90天的三阶段规划]
[格式：第一阶段（1-30天）：目标 > 第二阶段（31-60天）：目标 > 第三阶段（61-90天）：目标]

示例：
第一阶段（1-30天）：跑通流程，完成从开店到出单的完整闭环
第二阶段（31-60天）：优化放大，提升内容质量和转化率，稳定日均出单
第三阶段（61-90天）：规模化运营，多账号矩阵或品类扩展，实现月收入过万

项目关键步骤

[从详情页的"项目关键步骤"部分直接引用]
[格式：步骤1 > 步骤2 > **步骤3（关键）** > ...]
[保持和详情页完全一致]

航线图

[插入占位符文本，前端会自动替换为航线图截图]
（此处将显示详细的90天航线图，帮助你了解每个月、每个阶段的具体任务和里程碑目标）

操作重点

[从手册中提取4-6个最关键的操作注意事项]
[长途航海可以比短航海多1-2个重点]
[每个重点单独一段，用数字编号]
[每个重点包含标题（8-12字）+ 说明（50-80字）]

新手入门建议&避坑指南

新手常见问题

[从详情页的"新手常见问题"部分直接引用]
[保持和详情页完全一致]

开船前必备工具

[从详情页的"开船前必备工具"部分直接引用]
[保持和详情页完全一致]

风险挑战和应对建议

[从详情页的"风险挑战和应对建议"部分直接引用]
[保持和详情页完全一致]

适合人群

[从详情页的"适合人群"部分直接引用]
[保持和详情页完全一致]

内容出品人

[从手册中提取内容出品人信息]
[格式：姓名/昵称 + 简短介绍（一句话，20-30字）]

【生成步骤】

第一步：准确识别项目名称和类型
- 从手册封面、标题、第一页、目录中识别当前主项目名称
- 不要被手册中间部分的旧项目内容误导
- 判断项目类型：普通航海-项目类/技能类/交流类，还是长途航海-项目类
- 全文统一使用准确的项目名称

第二步：选择对应的模板结构
- 根据项目类型选择对应模板
- 严格按照模板的章节结构生成内容

第三步：生成本章概要
- 普通航海：80-120字
- 长途航海：120-150字
- 说明本课的目的和学员将获得什么

第四步：生成项目介绍部分
- 项目类：这是什么项目 + 市场现状
- 技能类：这是什么工具 + 为什么学这个
- 交流类：这个主题是什么 + 为什么关注这个
- 长途航海：这是什么项目 + 为什么做长途航海

第五步：从详情页引用内容
- 直接引用：项目简介、项目关键步骤、新手常见问题、开船前必备工具、风险挑战和应对建议、适合人群
- 保持格式和内容完全一致

第六步：生成操作重点/学习重点
- 项目类：从手册中提取3-5个操作重点（长途航海4-6个）
- 技能类/交流类：从手册中提取3-5个学习重点
- 每个重点包含标题（8-12字）+ 说明（50-80字）

第七步：生成航线图占位符
- 添加固定文本：（此处将显示详细的X天航线图...）

第八步：生成内容出品人
- 从手册中提取出品人信息
- 格式：姓名/昵称 + 一句话介绍（20-30字）

第九步：最后检查
- 是否没有使用emoji表情
- 是否准确引用详情页内容
- 项目名称是否统一准确
- 是否使用了正确的模板结构
- 是否没有使用markdown符号（除了**标注关键步骤**）

【特别提醒】

1. 项目名称识别（极其重要）：
   - 必须从手册封面、标题、第一页、目录中准确识别当前主项目名称
   - 不要被手册中间部分的旧项目内容误导
   - 例如：手册如果标题是"小红书垂直小店"，就不能写成"小红书蓝海实拍"
   - 全文必须统一使用准确的项目名称

2. 模板选择（极其重要）：
   - 必须根据项目类型选择正确的模板结构
   - 不同类型的模板结构不同，不能混用
   - 项目类有"项目介绍"、技能类有"学习完整路径"、交流类有"主题介绍"
   - 长途航海有"90天规划"

3. 内容引用规则：
   - 项目简介、项目关键步骤、新手常见问题、开船前必备工具、风险挑战和应对建议、适合人群 这6部分必须从详情页直接引用
   - 保持格式和内容完全一致
   - 不要修改或重新生成

4. 航线图占位符：
   - 必须添加航线图占位符文本
   - 前端系统会自动将这段文本替换为实际的航线图截图
   - 占位符格式：（此处将显示详细的X天航线图，帮助你了解...）

5. 内容出品人：
   - 必须添加内容出品人信息
   - 从手册中准确提取
   - 格式：姓名/昵称 + 一句话介绍

6. 格式严格要求：
   - 严禁使用emoji表情符号
   - 不使用 ## 标题符号
   - 不使用 - 或 * 的列表符号（内容引用除外）
   - 只在标注关键步骤时使用 **
   - 使用纯文本格式，用数字编号组织内容`;

async function updateTemplate() {
  console.log('🚀 开始更新开船第一课模板...\n');

  try {
    const { data, error } = await supabase
      .from('templates')
      .update({
        generation_prompt: firstLessonPrompt
      })
      .eq('component_type', 'first_lesson')
      .select();

    if (error) {
      console.error('❌ 更新失败:', error);
      process.exit(1);
    }

    console.log('✅ 开船第一课模板更新成功！');
    console.log('\n更新的记录:', data);
    console.log('\n现在可以去网页测试生成效果了！');
    process.exit(0);
  } catch (err) {
    console.error('❌ 发生错误:', err);
    process.exit(1);
  }
}

updateTemplate();
