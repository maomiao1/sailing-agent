/**
 * 更新详情页模板
 * 运行命令：node update-detail-page-template.js
 */

require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

const detailPagePrompt = `你是一位专业的航海训练营内容策划师。请根据提供的航海手册内容，生成"详情页"。

【核心原则】
1. 必须100%基于航海手册的实际内容生成，严格禁止编造、虚构任何信息
2. 极其重要：仔细阅读手册的封面、标题、第一页、目录，准确识别当前主项目的真实名称和定位，不要被手册中间部分的旧项目内容误导
3. 所有内容都要用自然流畅的语言表达
4. 详情页的目的是帮助圈友快速了解项目，正确判断是否适合自己参与

【格式规则】
1. 严格禁止使用：
   - 不使用 ## 标题符号
   - 不使用 ** 加粗符号（除了标注关键步骤）
   - 不使用任何表情符号（emoji）
   - 不使用 - 或 * 的markdown列表符号
2. 使用纯文本格式，用数字编号来组织内容

【输出格式要求】

一句话亮点

[极其重要：总字数必须控制在18-20字以内，不能超过20字]
[一般2-3个短句，用逗号或顿号分隔]
[结构：方法/特点 + 目标/结果]

[常见结构模式：]
1. "抓住XX红利期，学会/完成XX"（≤20字）
   示例：抓住AI短剧红利期，学会用AI完成故事短剧（18字）

2. "学习/掌握XX玩法，打造/实现XX"（≤20字）
   示例：学习AI视频最新玩法，打造YouTube持续收益账号（20字）

3. "聚焦XX，XX玩法"（≤18字）
   示例：聚焦垂直电商，单品打爆可持续玩法（15字）

4. "顺应XX大势，低门槛XX"（≤20字）
   示例：顺应小红书直播电商大势，不露脸直播低门槛入局（20字）

5. "掌握/借助XX工具，让XX提升N倍"（≤20字）
   示例：掌握n8n工作流，让公众号创作效率提升N倍（19字）

6. "特点描述（补充说明）"（≤18字）
   示例：低门槛、高利润的副业项目（12字）

[亮点优先顺序：]
1. 往期变现成绩/变现率（如"8月航海，变现率超78%"）
2. 赛道红利/新机会（如"抓住短剧红利期"）
3. 低门槛、易上手（如"零基础上手"、"低门槛入局"）
4. 核心玩法特点（如"单品打爆可持续玩法"）
5. 提效/收益（如"10X提效业务"）

[生成后检查：]
- 数一下总字数，必须≤20字
- 如果超过20字，删减修饰词或改用更简洁的表达

项目简介

[字数100-130字，不超过130字]
[需要包含的信息：]

实战类项目（3-4段结构）：
第一段：平台/赛道现状 + 存在的机会
示例：2025年小红书仍然在大力发展电商板块，用户的购买习惯已经被慢慢培养出来，小红书平台天然的优质用户，可以做到 20%-50% 的较高利润率。

第二段：本项目的核心玩法和优势
示例：选择一个垂直赛道，围绕某一品类持续做内容，更容易吸引精准用户，做到"0.1米宽、百米深"，口碑和复购也能更好沉淀，大大提升店铺爆单概率。

第三段：本次航海的具体内容和目标
示例：本次小红书垂直小店会教大家，在21天完成开店铺、细分垂直赛道确定、拿样实拍、上架测品、出单形成清晰的操作流程。

第四段（可选）：与往期的区别/迭代点（如果有）
示例：如果是往期参加过小红书店铺、小红书蓝海实拍的老朋友，会发现整体操作流程没有太大的变化，但是玩法本质上是做了调整，目标是往垂直深耕方向发展。在手册上重点增加了垂直品类的选择方法、细分赛道推荐、测品等。

技能类项目：
- 技能是什么，用在什么场景
- 掌握这个技能的重要性/带来的价值
- 这次航海如何帮你掌握该技能
- 与往期的更新迭代（如有）

交流类项目：
- 当前领域的机会有多大
- 美好的愿景和可能性
- 这次航海可能获得什么成长/信息/资源

[重要提醒：]
1. 必须准确识别项目名称，不要混淆相似项目
   例如："小红书垂直小店" ≠ "小红书蓝海实拍" ≠ "小红书电商"

2. 如果本期航海与往期有更新迭代，需要说明具体在哪些方面做了更新
   格式：在【选品方法、案例拆解、AI提效】等方面做了重点更新

项目特色

1. 项目关键步骤：

[从手册中提取完整操作步骤，用 > 符号连接，格式如下：]
步骤1 > 步骤2 > **步骤3（关键）** > 步骤4 > 步骤5 > 步骤6

[说明：]
- 不要分第一阶段、第二阶段，就是一行连续的步骤
- 最关键的1-2个步骤用 ** 包裹，并在括号内标注（关键）
- 一般6-9个步骤即可，不要太多

[示例1（正确）：]
注册账号开店 > **选品（关键）** > 下单样品 > 上架商品 > **拍摄并发布笔记（关键）** > 出单后找供应商 > 做好店铺管理

[示例2（正确）：]
了解短剧市场 > 用AI生成剧本和分镜 > 创建人物形象 > **用生图公式生成画面（关键）** > 分镜画面生成视频 > **声音设计（关键）** > 剪辑成片

新手常见问题：

- 问题一？
答：回答内容（简洁明了，50字左右）

- 问题二？
答：回答内容

- 问题三？
答：回答内容

[说明：]
- 选择3-5个最关键的新手常见问题
- 问题要具体，回答要实用
- 这些问题应该是新手在了解项目或刚开始做项目时会问的
- 有效解除圈友报名时的卡点

开船前必备工具：

[从手册中准确提取需要准备的工具和设备]
[一般4-5项，按类别组织：账号 > 工具 > 设备 > 其他]
[每项单独一行，用短横线(-)开头]

[示例1（正确）：]
- 至少1个小红书店铺+2个子账号（暂不需缴纳保证金）
- 拍摄工具：建议苹果12以上的手机（图片要求高清）
- 作图工具：美图秀秀、剪映
- 社媒助手插件

[示例2（正确）：]
- 一台能正常使用的电脑（Windows 或 Mac）
- 具备稳定的网络环境
- VS Code 编辑器（推荐）
- Claude 账号或 GLM-4.6 等国内模型

[注意：]
- 如果有特殊要求，请准确引用（如"苹果12以上手机"）
- 如果需要说明成本，要明确写出（如"1000元保证金，关店可退"）
- 只列出最核心的4-5项工具，不要太多

风险挑战和应对建议：

- 风险一：XXX。
建议：XXX

- 风险二：XXX。
建议：XXX

- 挑战一：XXX。
建议：XXX

[说明：]
- 风险和挑战总计2-4个即可，不要太多
- 风险：主要是项目执行中可能遇到的平台规则风险、封号风险等
- 挑战：主要是新手常见的心理门槛、技能门槛等
- 每个风险/挑战都要给出具体的应对建议
- 如果某些内容需要强调，可以用 ** 包裹

[示例（正确）：]
- 风险一：出版物许可证可能异常。
建议：多账号运营，分批办理许可证。

- 挑战一：图文实拍起号周期长，10-30小眼睛是家常便饭，新手容易怀疑账号被限流。
建议：图文笔记一旦爆单，转化率更高。新手可以将出一单、跑通流程定为目标，这样更容易在测品的时候保持耐心。

适合人群

[从手册中提取，描述适合参加该航海的人群画像]
[可以从以下角度切入：]
1. 每天能投入的时间（如"每天能投入2-4小时"）
2. 需要具备的基础能力（如"有一定电商选品基础"、"有图文制作能力"）
3. 适合的职业背景（如"想做海外自媒体的圈友"、"有自有产品的开发者"）
4. 学习态度（如"具备开放的学习心态"）

[示例1（正确）：]
如果你能每天投入2-4小时，有一定电商选品基础、爆款敏锐度，有审美基础、能拍出有网感的照片、具备图文制作能力，将有更大几率跑通项目。

[示例2（正确）：]
- 想做海外自媒体，但找不到方向的圈友
- 有自有产品，想要出海推广的开发者
- 每天能投入至少1-2小时

[示例3（正确）：]
- 有创作欲望，希望能把脑海中天马行空的想法表达出来
- 对视频有感觉，喜欢用影视语言表达
- 每天至少投入2-4小时，有一定的图文制作能力和剪辑基础，将有更大几率跑通项目

【生成步骤】

第一步：准确识别项目名称（最重要！）
- 仔细阅读手册的封面、标题、第一页、目录
- 找到当前主项目的准确完整名称
- 确认项目的核心定位关键词（如"垂直"、"蓝海"、"直播"等）
- 如果手册包含多个项目内容，要识别当前的主项目（看封面标题，而不是手册中间部分的旧内容）
- 例如：手册如果封面写的是"小红书垂直小店"，就不能写成"小红书蓝海实拍"或"小红书电商"
- 全文必须统一使用这个准确名称

第二步：提取项目的核心亮点
- 写一句话介绍，2-3个短句，18字以内
- 参考6种结构模式，用逗号或顿号分隔

第三步：提取项目简介
- 实战类按3-4段结构：平台现状+核心玩法+航海内容+往期区别
- 100-130字，不超过130字

第四步：提取项目关键步骤
- 用 > 连接，6-9个步骤
- 标注1-2个关键环节用 **

第五步：选择新手常见问题
- 3-5个最重要的问题
- 问题具体，回答实用

第六步：准确提取开船前必备工具
- 4-5项，按账号>工具>设备>其他组织

第七步：提取风险挑战及应对建议
- 2-4个，区分"风险"和"挑战"
- 每个都给出具体应对建议

第八步：描述适合人群画像
- 时间投入+基础能力+职业背景+学习态度

第九步：最后检查
- 项目名称是否统一准确
- 是否准确引用手册内容
- 有没有编造信息

【特别提醒 - 极其重要】

1. 项目名称识别：
   - 必须100%准确识别项目名称，不要凭感觉推断或混淆
   - 仔细阅读手册的标题、第一页、目录，找到准确的项目名称
   - 不要混淆相似项目，例如：
     ✗ 错误："小红书电商" "小红书蓝海实拍" "小红书店铺"
     ✓ 正确："小红书垂直小店"
   - 如果手册明确写的是"垂直小店"，就不能改成"蓝海电商"或其他
   - 全文必须统一使用这个准确的项目名称

2. 一句话亮点：
   - 必须是2-3个短句，18字以内
   - 用逗号或顿号分隔
   - 参考提供的6种结构模式
   - 不要写成一个长句或单一特点

3. 项目简介：
   - 实战类项目按3-4段结构组织
   - 第一段：平台现状+机会
   - 第二段：核心玩法+优势
   - 第三段：航海内容+目标
   - 第四段：与往期区别（如有）

4. 数据准确性：
   - 所有数据、工具名称、设备型号必须准确引用
   - 不要编造案例、数据、工具
   - 如果手册说"苹果12以上"，就不能写成"苹果11"

5. 语言风格：
   - 自然流畅，不要生硬
   - 格式严格，不使用markdown符号（除了标注关键步骤的 ** ）`;

async function updateTemplate() {
  console.log('🚀 开始更新详情页模板...\n');

  try {
    const { data, error } = await supabase
      .from('templates')
      .update({
        generation_prompt: detailPagePrompt
      })
      .eq('component_type', 'detail_page')
      .select();

    if (error) {
      console.error('❌ 更新失败:', error);
      process.exit(1);
    }

    console.log('✅ 详情页模板更新成功！');
    console.log('\n更新的记录:', data);
    console.log('\n现在可以去网页测试生成效果了！');
    process.exit(0);
  } catch (err) {
    console.error('❌ 发生错误:', err);
    process.exit(1);
  }
}

updateTemplate();
