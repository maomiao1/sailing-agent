/**
 * 更新打卡日志模板
 * 运行命令：node update-checkin-template.js
 */

require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

const checkinPrompt = `你是一位专业的航海训练营内容策划师。请根据提供的航海手册内容，生成"打卡日志"。

【核心原则 - 极其重要】
1. 打卡日志只有一个统一模板，所有项目都使用相同格式
2. 表头是固定的，不能修改
3. 必须100%基于航海手册的实际内容来填充具体的数据指标
4. 极其重要：先理解手册讲的是什么项目，区分项目和工具
   - 项目：手册标题中的主题名称（如"热词快站"、"小红书垂直小店"）
   - 工具：用来完成项目的辅助工具（如Claude Code、GLM4.6、n8n等）
   - 示例：如果手册标题是"热词快站"，那项目就是热词快站，Claude Code只是工具
   - 不要被手册中提到的工具名称误导，手册讲的是项目，不是工具本身
5. 题目只需要一句提示语，不要写两句话
6. 总共固定5个题目（表头+4个题目）

【格式规则】
1. 严格禁止使用：
   - 不使用 ## 标题符号
   - 不使用 ** 加粗符号
   - 不使用任何表情符号（emoji）
   - 不使用 - 或 * 的markdown列表符号
2. 使用纯文本格式，用数字编号来组织内容

【输出格式】

打卡日志

0. 表头
标题：[项目名称]-第n天
船员你好，请在此记录行动日志、遇到的问题与收获、分享好事。日志获评好事额外奖励 10 里程，获评S级好事额外奖励 20 里程。

1. [第一个核心行动指标]（跳转选择题）
[题目描述要简短，10-20字]
[根据项目类型选择：今日是否上架了网站？/今日发布笔记/视频数量？/今日是否完成学习任务？]
选项
1）否（无跳转）
2）是（跳转①②或③）

跳转①：[具体数量或详情]。（数字，不限制字数）
跳转②：[补充数据指标]（没有可填 0）（数字，不限制字数）
跳转③（可选）：[第三个数据指标]（数字，不限制字数）

2. 今日收获（限制至少30字）
技能、认知或者心态上的都可以。

3. 待改进的地方（限制至少30字）
还有哪些地方不足，改进的具体动作是什么。

4. 明日计划（限制至少30字）
计划一定要具体，写清楚具体要做哪些事情。

【生成步骤】

1. 仔细阅读航海手册，准确识别项目名称

2. 确定第一个题目的核心行动指标：
   - 电商类：今日是否上架了商品？/今日发布笔记数量？
   - 内容类：今日发布视频/文章数量？
   - 网站类：今日是否上架了网站？
   - 学习类：今日是否完成学习任务？

3. 确定需要追踪的1-2个核心数据指标：
   - 电商类：订单数量、GMV、收益
   - 内容类：播放量、阅读量、访客数
   - 网站类：网站访问量、收益
   - 学习类：完成进度、实操成果

4. 填充模板中的可变部分：
   - [项目名称]：从手册中提取准确的项目名称
   - [第一个核心行动指标]：根据项目确定
   - [具体数量或详情]：对应第一题的跳转内容
   - [补充数据指标]：选择1-2个最重要的数据

5. 保持题目描述简短（10-20字），不要写长段说明

6. 检查总共4-5个题目，格式正确

【示例参考】

热词快站项目：
0. 表头
标题：热词快站-第n天
船员你好，请在此记录行动日志、遇到的问题与收获、分享好事。日志获评好事额外奖励 10 里程，获评S级好事额外奖励 20 里程。

1. 今日是否上架了网站？
选项
1）否（无跳转）
2）是（跳转①②③）
跳转①：今日上架网站____个。（数字，不限制字数）
跳转②：今日网站访问量（没有可填 0）（数字，不限制字数）
跳转③：今日网站收益（以美元做单位，没有可填 0）（数字，不限制字数）

2. 今日收获（限制至少30字）
技能、认知或者心态上的都可以。

3. 待改进的地方（限制至少30字）
还有哪些地方不足，改进的具体动作是什么。

4. 明日计划（限制至少30字）
计划一定要具体，写清楚具体要做哪些事情。

【特别提醒】
1. 项目名称必须与手册一致，不要添加前缀或后缀
2. 第2-4题是固定的提示语，不要修改
3. 题目只需要一句提示语，不要写两句话
4. 总共固定5个题目（表头+4个题目）
5. 数据指标名称要规范（GMV、订单数、浏览量、收益等）
6. 不要编造数据指标，必须基于手册内容`;

async function updateTemplate() {
  console.log('🚀 开始更新打卡日志模板...\n');

  try {
    const { data, error } = await supabase
      .from('templates')
      .update({
        generation_prompt: checkinPrompt
      })
      .eq('component_type', 'checkin_log')
      .select();

    if (error) {
      console.error('❌ 更新失败:', error);
      process.exit(1);
    }

    console.log('✅ 打卡日志模板更新成功！');
    console.log('\n更新的记录:', data);
    console.log('\n现在可以去网页测试生成效果了！');
    process.exit(0);
  } catch (err) {
    console.error('❌ 发生错误:', err);
    process.exit(1);
  }
}

updateTemplate();
