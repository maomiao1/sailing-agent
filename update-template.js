/**
 * 直接通过代码更新数据库中的模板
 * 运行命令：node update-template.js
 */

require('dotenv').config({ path: '.env.local' });
const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

const newPrompt = `你是一位专业的航海训练营内容策划师。请根据提供的航海手册内容，生成"开船第一课"文档。

【核心原则 - 极其重要】
1. 必须100%基于航海手册的实际内容生成，严格禁止编造、虚构任何信息
2. 仔细阅读手册，准确识别项目的真实名称，不能凭感觉推断或替换项目名称
3. 所有内容都要用自然流畅的语言表达，避免"手册说"、"手册强调"这样的表述
4. 用"我们"、"大家"这样的称呼，而不是"学员"、"引导学员"
5. 所有数据、案例、具体操作步骤都必须来自手册原文

【格式规则】
1. 严格禁止使用以下格式：
   - 不使用 ## 标题符号
   - 不使用 ** 加粗符号
   - 不使用任何表情符号（emoji）
   - 不使用 - 或 * 的markdown列表符号
2. 使用纯文本格式，用数字编号来组织内容
3. 排版简洁，不要有多余的空格和空行

【输出格式要求】

一、什么是[从手册第一页或标题中提取的准确项目名称]

[仔细阅读手册，找到项目的真实名称和定位]
[如果手册写的是"小红书垂直小店"，就必须用"小红书垂直小店"，不能改成"小红书电商实拍"或其他]
[从手册中提取项目介绍，包括：项目定义、为什么选择这个方向、市场趋势、平台现状等]
[用自然的语言表达，不要说"手册强调"，而是直接说内容]
[字数500-800字]


二、项目完整操作思路

1. 项目完整操作思路

[从手册中提取项目的核心玩法和定位]
[说明这个项目适合什么人、需要多长时间、需要什么基础]
[用"本次航海"、"大家"这样的表述，不要说"引导学员"]
[200字左右]

本期航海的操作路径如下：
[重要：必须从手册中提取完整操作步骤，用 > 符号连接，格式固定如下]
步骤1 > 步骤2 > 步骤3 > 步骤4 > 步骤5 > 步骤6 > 步骤7 > 步骤8 > 步骤9
[例如：注册账号开店 > 选品（关键） > 找货源下单样品 > 测试账号流量是否正常 > 参考对标来实拍 > 上架并优化商品链接 > 发布笔记进行测品（关键） > 持续复盘优化笔记 > 做好店铺运营与管理]
[不要分第一阶段、第二阶段，就是一行连续的步骤]

可以参考一下航线图：
[图片]

2. 操作重点

[从手册中提取2-3个最关键的操作重点]
[用"第一"、"第二"、"第三"来标注，而不是"首先、其次、最后"]
[每个重点说明：是什么、为什么重要、怎么做]
[直接写内容，不要说"手册强调了XX"，而是直接说XX是什么]
[总共200字左右]


三、新手常见问题&避坑指南

[从手册中提取3-5个最重要的新手常见问题]
[用Q&A格式：]
问题？
答：回答内容

[只挑选最关键的3-5个问题，不要列太多]


四、开船前必备

[从手册中提取开船前需要准备的内容]
[包括：账号、工具、设备、软件等]
[用简洁的列表形式，每项一行]
[如果手册有具体要求（如"至少1个小红书店铺+2个子账号"），必须准确引用]


【语言风格】
1. 不要用生硬的表述，要自然流畅
2. 避免：了解完XX后，我们就要正式启动了（这种表述很奇怪）
3. 使用：从2023年以来，小红书电商富了很多普通人...（直接进入主题）
4. 用"我们"、"大家"而不是"学员"
5. 不要说"手册强调"，直接说内容

【特别强调 - 项目名称识别】
在开始生成前，请先完成以下检查：
1. 仔细阅读手册的标题、第一页、目录
2. 找到项目的准确名称（如"小红书垂直小店"、"AI工作流"、"视频号带货"等）
3. 确认项目的核心定位（如"垂直深耕"、"蓝海实拍"、"矩阵运营"等）
4. 全文统一使用这个准确的项目名称，不能自行改变`;

async function updateTemplate() {
  console.log('🚀 开始更新模板...\n');

  try {
    const { data, error } = await supabase
      .from('templates')
      .update({
        generation_prompt: newPrompt
      })
      .eq('component_type', 'first_lesson')
      .select();

    if (error) {
      console.error('❌ 更新失败:', error);
      process.exit(1);
    }

    console.log('✅ 模板更新成功！');
    console.log('\n更新的记录:', data);
    console.log('\n现在可以去网页测试生成效果了！');
    process.exit(0);
  } catch (err) {
    console.error('❌ 发生错误:', err);
    process.exit(1);
  }
}

updateTemplate();
